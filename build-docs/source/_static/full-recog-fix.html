<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>full recog fix</title>
    <link
      href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      #select-btn-group {
        display: flex;
        justify-content: center;
      }
      #select-btn-group-test {
        display: flex;
        justify-content: center;
      }

      .hidden {
        display: hidden;
      }

      #countdown-header {
        transform: translateY(25rem);
        background: white;
        padding: 1rem;
        font-weight: bold;
      }
      #countdown-header-test {
        transform: translateY(25rem);
        background: white;
        padding: 1rem;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <section
      class="container"
      id="other"
      style="
        margin-bottom: 15px;
        padding: 10px 10px;
        font-family: Verdana, Geneva, sans-serif;
        color: #333333;
        font-size: 0.9em;
      "
    >
      <div class="row col-xs-12 col-md-12">
        <!-- Instructions -->
        <div class="panel panel-primary" id="Instructions">
        <div class="panel-heading"><strong>Instructions</strong></div>

        <div class="panel-body">
        <p>In this job, you are asked to select the class of the object in each image from the given list of choices.</p>

        <p>Each task is timed and you can look at the picture for just 200 ms before it disappear so stay focused!</p>

        <p><em><b>The estimated time for this HIT is about 40 seconds.</b></em><br />

        <p><em><b style="color:red;">If you submit the HIT without completing the task, it will automatically be rejected. Please DO NOT press ENTER at any time during the HIT as this may resluto automaticcaly submit the HIT without completing it.</b></em></p>

        <h3>Task example</h3>

        <div class="panel panel-primary" id="exampleIntro">
        <div class="panel-body">
        <h3 align="center">This is an example of a </h3>

        <h2 align="center" style="color:red;"><b>car</b></h2>

        <p align="center"><img align="middle" id="imgExample" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00014541.JPEG" style="height:400px;" /></p>
        </div>
        </div>

        <h3>More examples</h3>

        <table align="center">
          <thead>
            <tr>
              <th>
              <h3 align="center">not a car (a ship)</h3>
              </th>
              <th>
              <h3 align="center">not a car (a helmet)</h3>
              </th>
              <th>
              <h3 align="center">not a car (a cat)</h3>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td width="33%"><img alt="a ship" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00024089.JPEG" style="display:block;" width="90%" /></td>
              <td width="33%"><img alt="a helmet" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00004202.JPEG" style="display:block;" width="90%" /></td>
              <td width="33%"><img alt="a cat" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00002036.JPEG" style="display:block;" width="90%" /></td>
            </tr>
          </tbody>
        </table>

        <table align="center">
          <thead>
            <tr>
              <th>
              <h3 align="center"> a car (ambulance)</h3>
              </th>
              <th>
              <h3 align="center"> a car</h3>
              </th>
              <th>
              <h3 align="center"> a car</h3>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td width="33%"><img alt="ambulance" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00001910.JPEG" style="display:block;" width="90%" /></td>
              <td width="33%"><img alt="" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00013517.JPEG" style="display:block;" width="90%" /></td>
              <td width="33%"><img alt="" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00003473.JPEG" style="display:block;" width="90%" /></td>
            </tr>
            
          </tbody>
        </table>
        <p align="center"><input id="proceedButton" onclick=" document.getElementById('Instructions').style.display = 'none'; document.getElementById('QtestStart').style.display = 'block'" style="height:50px" type="button" value="" /></p>
        </div>
        </div>
        <!-- end Instructions -->
            
        <!-- Qualification test 1st panel -->
        <div class="panel panel-primary" id="QtestStart" style="display:none;">
        <div class="panel-heading"><strong>Qualification test</strong></div>

        <div id="qTestPolygons" class="panel-body">
        <p>If this is the your first HIT of this project, you should first pass a simple qualification test where you are asked to pick the most appropriate class of 20 toy images.</p>


        <p>In order to pass the qualification test, you need to correctly identify <em>all 20 </em>images. </p>

        <div class="panel panel-primary" id="exampleIntro">
        <div class="panel-body">
        <h3 align="center">Select the most approprite class that describe the image</h3>

        <p align="center"><img align="middle" id="imgExample" src="https://pilotexp.s3.ca-central-1.amazonaws.com/Examples_Experiment/ILSVRC2012_val_00014541.JPEG" style="height:400px;" /></p>
        </div>
        </div>

        <p>This is an image of a <b style="color:red;text-shadow: 0px 0px 2px #000000">car</b> </p>

        <p>If you have already passed this test in a previous HIT,you have the option to insert the qualification password here in order to skip the test: <input id="pswQualification" onchange="checkPassQual()" type="text" value="" /></p>

        <p align="center"><input id="qTestButton" onclick="startTest(); document.getElementById('QtestStart').style.display = 'none'; document.getElementById('QTest').style.display = 'block'" style="height:50px;width:100px" type="button" value="Start" /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input id="skipButton" onclick=" document.getElementById('QtestStart').style.display = 'none'; document.getElementById('WorkSession').style.display = 'block'" style="height:50px;width:100px" type="button" value="Skip" /></p> 
        </div>
       
        </div>
        <!-- End of Qualification test 1st panel -->
            
        <!-- QTest -->
        <div class="panel panel-primary" id="QTest" style="display:none;">
        <div class="panel-heading"><strong>Qualification test</strong></div>


        <div class="panel-body">
        <h3 align="center">Click on the most approprite class for this image.</h3>
        <h1 id="countdown-header-test" class="hidden" align="center">Countdown:</h1>
        <p align="center"><img align="middle" id="testimg1" src="${testimage1}" style="height:400px;" /></p>
        </div>

        </p>
            <div id="select-btn-group-test">
              <button type="button" id="car-select-btn" value="car">car</button>
              <button type="button" id="not-car-select-btn" value="not car">not car</button>
            </div>
            <p align="center" id="workCountImages">&nbsp;</p>
          </div>
        </div>
        <!-- end QTest -->
            
        <!-- QFeedback-->
        <div class="panel panel-primary" id="QFeedback" style="display:none;">
        <div class="panel-heading"><strong>Qualification test: Feedback</strong></div>

        <div class="panel-body">
        <div id="feedbackContent">
        <h2>Here is your feeback</h2>
        </div>
        </div>
        </div>
        <!-- end QFeedback -->
            
        <!-- Qresults -->
        <div class="panel panel-primary" id="QResults" style="display:none;">
        <div class="panel-heading"><strong>Qualification test: Results</strong></div>

        <div class="panel-body">
        <div id="resultsFail1" style="display: none;">
        <h1 style="color:red;font-weight: bold;">FAIL!</h1>
        <br />
        <br />
        You failed the qualification test.<br />
        <br />
        If you want, you can do the qualification test once more by pressing the button below.<br />
        Otherwise, please RETURN the HIT.<br />
        <br />
        <br />
        <input id="qTestButton2" onclick="startTest(); document.getElementById('QResults').style.display = 'none'; document.getElementById('QFeedback').style.display = 'none'; document.getElementById('QTest').style.display = 'block'; document.getElementById('canvasFeed1').style.display = 'none'" style="height:50px;width:150px" type="button" value="Re-do the test" /></div>

        <div id="resultsFail2" style="display: none;">
        <h1 style="color:red;font-weight: bold;">FAIL!</h1>
        <br />
        You failed the qualification test for second time.<br />
        <br />
        Unfortunately, you can not proceed to the task.<br />
        <br />
        Please RETURN the HIT.
        <p>&nbsp;</p>
        </div>

        <div id="resultsSuccess" style="display: none;">
        <h1 style="color:green;font-weight: bold;">PASS!</h1>
        <br />
        Congratulations! You successfully passed the qualification test.<br />
        <br />
        The password for the qualification task is:
        <div id="writePassword"> </div>
        This password will let you skip the qualification test from now on if you want to accept more HITs of this task.<br />
        <br />
        Please press the button below to proceed to the task.<br />
        <br />
        <br />
        <input id="skipButton2" onclick=" document.getElementById('QResults').style.display = 'none';  document.getElementById('QFeedback').style.display = 'none'; document.getElementById('WorkSession').style.display = 'block'; document.getElementById('canvasFeed1').style.display = 'none'; document.getElementById('canvasFeed2').style.display = 'none'" style="height:50px;width:200px" type="button" value="PROCEED to the task" /></div>
        </div>
        </div>
        <!-- end Qresults -->
        <!-- Main task start -->
        <div class="panel panel-primary" id="WorkSession" style="display: none">
          <div class="panel-heading"><strong>Main task</strong></div>
          <div class="panel-body">
            <p>
              In this task, you are asked to see a batch of ${numImages} images and choose the
              classes for the objects in them.
            </p>
            <p>You are expected to take about <strong>2</strong> seconds per image.</p>
            <p>
              <em
                ><b style="color: red"
                  >We will monitor your accuracy during this task. Failing to have a good accuracy
                  will not let you submit this HIT and as a result you can not be paid.</b
                ></em
              >
            </p>
            <p align="center">
              <button
                id="startButton"
                onclick="startWork(); document.getElementById('WorkSession').style.display = 'none'; document.getElementById('Work').style.display = 'block'"
                style="height: 50px; width: 100px"
                type="button"
              >
                Start!
              </button>
            </p>
          </div>
        </div>
        <!-- end Main task start -->
        <!-- Work -->
        <div class="panel panel-primary" id="Work" style="display: none">
          <div class="panel-heading"><strong>Select the class</strong></div>
          <div class="panel-body">
            <h3 align="center">Select the most approprite class for the object in the image</h3>
            <h1 id="countdown-header" class="hidden" align="center">Countdown:</h1>
            <p align="center">
              <img align="middle" id="img1" src="${image1}" style="height: 400px" />
              <img align="middle" id="img2" src="${image2}" style="display: none; height: 400px" />
              <img align="middle" id="img3" src="${image3}" style="display: none; height: 400px" />
              <img align="middle" id="img4" src="${image4}" style="display: none; height: 400px" />
              <img align="middle" id="img5" src="${image5}" style="display: none; height: 400px" />
              <img align="middle" id="img6" src="${image6}" style="display: none; height: 400px" />
              <img align="middle" id="img7" src="${image7}" style="display: none; height: 400px" />
              <img align="middle" id="img8" src="${image8}" style="display: none; height: 400px" />
              <img align="middle" id="img9" src="${image9}" style="display: none; height: 400px" />
              <img
                align="middle"
                id="img10"
                src="${image10}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img11"
                src="${image11}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img12"
                src="${image12}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img13"
                src="${image13}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img14"
                src="${image14}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img15"
                src="${image15}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img16"
                src="${image16}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img17"
                src="${image17}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img18"
                src="${image18}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img19"
                src="${image19}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img20"
                src="${image20}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img21"
                src="${image21}"
                style="display: none; height: 400px"
              />
              <img
                align="middle"
                id="img22"
                src="${image22}"
                style="display: none; height: 400px"
              />
            </p>
            <div id="select-btn-group">
              <button type="button" id="car-select-btn" value="car">car</button>
              <button type="button" id="not-car-select-btn" value="not car">not car</button>
            </div>
            <p align="center" id="workCountImages">&nbsp;</p>
          </div>
        </div>
        <!-- end Work -->
        <!-- Finish panel -->
        <div class="panel panel-primary" id="Finish" style="display: none">
          <div class="panel-heading"><strong>Task completed</strong></div>
          <div class="panel-body">
            <div id="finishText">&nbsp;</div>
            <p>Thank you. We conducted this experiment with human participants in the context of an academical research project. If you want to be updated with the scientific progress made thanks to your participation in this experiment, please drop your email <a href='https://docs.google.com/forms/d/e/1FAIpQLSfQOvc2lbEeLg71nyAg8_KBS35PeIOpnjINkmq27EdZWFzbvg/viewform?usp=sf_link'>here</a> </p>
          </div>
        </div>
        <!-- end Finish panel -->
        <!-- Low accuracy panel -->
        <div class="panel panel-primary" id="LowAccuracy" style="display: none">
          <div class="panel-heading"><strong>Task failed</strong></div>

          <div class="panel-body">
            <p>Sorry, we cannot accept your HIT because either your accuracy for this HIT was low or answers are missing for some images in this HIT. Please return the HIT.</p>

            <p>
              If you would like to try again, we suggest you do again the qualification task and pay
              more attention to the feedback page.
            </p>
          </div>
        </div>
        <!-- end Low accuracy panel -->
        <!-- Missing answers panel -->
        <div class="panel panel-primary" id="MissingAnswers" style="display: none">
          <div class="panel-heading"><strong>Task failed</strong></div>

          <div class="panel-body">
            <p>HIT is not complete becaues answer(s) are missing for some images in this HIT. Please return the HIT.</p>

            <p>
              If you would like to try again, we suggest you do again the qualification task and pay
              more attention to the feedback page.
            </p>
          </div>
        </div>
        <!-- end Missing answers panel -->
      </div>
    </section>
    <p id="hiddenUserAnswers">
      <input id="useranswerX1" name="answer" type="hidden" value="" />
      <input id="useranswerX2" name="answer" type="hidden" value="" />
      <input id="useranswerX3" name="answer" type="hidden" value="" />
      <input id="useranswerX4" name="answer" type="hidden" value="" />
      <input id="useranswerX5" name="answer" type="hidden" value="" />
      <input id="useranswerX6" name="answer" type="hidden" value="" />
      <input id="useranswerX7" name="answer" type="hidden" value="" />
      <input id="useranswerX8" name="answer" type="hidden" value="" />
      <input id="useranswerX9" name="answer" type="hidden" value="" />
      <input id="useranswerX10" name="answer" type="hidden" value="" />
      <input id="useranswerX11" name="answer" type="hidden" value="" />
      <input id="useranswerX12" name="answer" type="hidden" value="" />
      <input id="useranswerX13" name="answer" type="hidden" value="" />
      <input id="useranswerX14" name="answer" type="hidden" value="" />
      <input id="useranswerX15" name="answer" type="hidden" value="" />
      <input id="useranswerX16" name="answer" type="hidden" value="" />
      <input id="useranswerX17" name="answer" type="hidden" value="" />
      <input id="useranswerX18" name="answer" type="hidden" value="" />
      <input id="useranswerX19" name="answer" type="hidden" value="" />
      <input id="useranswerX20" name="answer" type="hidden" value="" />
      <input id="useranswerX21" name="answer" type="hidden" value="" />
      <input id="useranswerX22" name="answer" type="hidden" value="" />
      <input id="useranswerY1" name="answer" type="hidden" value="" />
      <input id="useranswerY2" name="answer" type="hidden" value="" />
      <input id="useranswerY3" name="answer" type="hidden" value="" />
      <input id="useranswerY4" name="answer" type="hidden" value="" />
      <input id="useranswerY5" name="answer" type="hidden" value="" />
      <input id="useranswerY6" name="answer" type="hidden" value="" />
      <input id="useranswerY7" name="answer" type="hidden" value="" />
      <input id="useranswerY8" name="answer" type="hidden" value="" />
      <input id="useranswerY9" name="answer" type="hidden" value="" />
      <input id="useranswerY10" name="answer" type="hidden" value="" />
      <input id="useranswerY11" name="answer" type="hidden" value="" />
      <input id="useranswerY12" name="answer" type="hidden" value="" />
      <input id="useranswerY13" name="answer" type="hidden" value="" />
      <input id="useranswerY14" name="answer" type="hidden" value="" />
      <input id="useranswerY15" name="answer" type="hidden" value="" />
      <input id="useranswerY16" name="answer" type="hidden" value="" />
      <input id="useranswerY17" name="answer" type="hidden" value="" />
      <input id="useranswerY18" name="answer" type="hidden" value="" />
      <input id="useranswerY19" name="answer" type="hidden" value="" />
      <input id="useranswerY20" name="answer" type="hidden" value="" />
      <input id="useranswerY21" name="answer" type="hidden" value="" />
      <input id="useranswerY22" name="answer" type="hidden" value="" />
      <input id="useranswerCat1" name="answer" type="hidden" value="" />
      <input id="useranswerCat2" name="answer" type="hidden" value="" />
      <input id="useranswerCat3" name="answer" type="hidden" value="" />
      <input id="useranswerCat4" name="answer" type="hidden" value="" />
      <input id="useranswerCat5" name="answer" type="hidden" value="" />
      <input id="useranswerCat6" name="answer" type="hidden" value="" />
      <input id="useranswerCat7" name="answer" type="hidden" value="" />
      <input id="useranswerCat8" name="answer" type="hidden" value="" />
      <input id="useranswerCat9" name="answer" type="hidden" value="" />
      <input id="useranswerCat10" name="answer" type="hidden" value="" />
      <input id="useranswerCat11" name="answer" type="hidden" value="" />
      <input id="useranswerCat12" name="answer" type="hidden" value="" />
      <input id="useranswerCat13" name="answer" type="hidden" value="" />
      <input id="useranswerCat14" name="answer" type="hidden" value="" />
      <input id="useranswerCat15" name="answer" type="hidden" value="" />
      <input id="useranswerCat16" name="answer" type="hidden" value="" />
      <input id="useranswerCat17" name="answer" type="hidden" value="" />
      <input id="useranswerCat18" name="answer" type="hidden" value="" />
      <input id="useranswerCat19" name="answer" type="hidden" value="" />
      <input id="useranswerCat20" name="answer" type="hidden" value="" />
      <input id="useranswerCat21" name="answer" type="hidden" value="" />
      <input id="useranswerCat22" name="answer" type="hidden" value="" />
    </p>

    <p id="testhiddenUserAnswers">
      <input id="testuseranswerX1" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX2" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX3" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX4" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX5" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX6" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX7" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX8" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX9" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX10" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX11" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX12" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX13" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX14" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX15" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX16" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX17" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX18" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX19" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX20" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX21" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX22" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX23" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX24" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX25" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX26" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX27" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX28" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX29" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX30" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX31" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX32" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX33" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX34" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX35" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX36" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX37" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX38" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX39" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerX40" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY1" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY2" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY3" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY4" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY5" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY6" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY7" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY8" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY9" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY10" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY11" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY12" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY13" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY14" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY15" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY16" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY17" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY18" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY19" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY20" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY21" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY22" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY23" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY24" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY25" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY26" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY27" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY28" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY29" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY30" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY31" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY32" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY33" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY34" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY35" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY36" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY37" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY38" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY39" name="answer_test" type="hidden" value="" />
      <input id="testuseranswerY40" name="answer_test" type="hidden" value="" />
    </p>

    <p id="hiddenRT">
      <input id="rt1" name="responsetime" type="hidden" value="" />
      <input id="rt2" name="responsetime" type="hidden" value="" />
      <input id="rt3" name="responsetime" type="hidden" value="" />
      <input id="rt4" name="responsetime" type="hidden" value="" />
      <input id="rt5" name="responsetime" type="hidden" value="" />
      <input id="rt6" name="responsetime" type="hidden" value="" />
      <input id="rt7" name="responsetime" type="hidden" value="" />
      <input id="rt8" name="responsetime" type="hidden" value="" />
      <input id="rt9" name="responsetime" type="hidden" value="" />
      <input id="rt10" name="responsetime" type="hidden" value="" />
      <input id="rt11" name="responsetime" type="hidden" value="" />
      <input id="rt12" name="responsetime" type="hidden" value="" />
      <input id="rt13" name="responsetime" type="hidden" value="" />
      <input id="rt14" name="responsetime" type="hidden" value="" />
      <input id="rt15" name="responsetime" type="hidden" value="" />
      <input id="rt16" name="responsetime" type="hidden" value="" />
      <input id="rt17" name="responsetime" type="hidden" value="" />
      <input id="rt18" name="responsetime" type="hidden" value="" />
      <input id="rt19" name="responsetime" type="hidden" value="" />
      <input id="rt20" name="responsetime" type="hidden" value="" />
      <input id="rt21" name="responsetime" type="hidden" value="" />
      <input id="rt22" name="responsetime" type="hidden" value="" />
    </p>

    <p id="hiddenTestRT">
      <input id="TestRT" name="TestResponseTime" type="hidden" value="" />
    </p>

    <p id="hiddenTestAcc">
      <input id="TestAccuracy" name="TestAcc" type="hidden" value="" />
    </p>

    <p id="hiddenInputTestImageSouce" style="display: none">
      <input id="SRCtestimage1" type="hidden" value="${testimage1}" />
      <input id="SRCtestimage2" type="hidden" value="${testimage2}" />
      <input id="SRCtestimage3" type="hidden" value="${testimage3}" />
      <input id="SRCtestimage4" type="hidden" value="${testimage4}" />
      <input id="SRCtestimage5" type="hidden" value="${testimage5}" />
      <input id="SRCtestimage6" type="hidden" value="${testimage6}" />
      <input id="SRCtestimage7" type="hidden" value="${testimage7}" />
      <input id="SRCtestimage8" type="hidden" value="${testimage8}" />
      <input id="SRCtestimage9" type="hidden" value="${testimage9}" />
      <input id="SRCtestimage10" type="hidden" value="${testimage10}" />
      <input id="SRCtestimage11" type="hidden" value="${testimage11}" />
      <input id="SRCtestimage12" type="hidden" value="${testimage12}" />
      <input id="SRCtestimage13" type="hidden" value="${testimage13}" />
      <input id="SRCtestimage14" type="hidden" value="${testimage14}" />
      <input id="SRCtestimage15" type="hidden" value="${testimage15}" />
      <input id="SRCtestimage16" type="hidden" value="${testimage16}" />
      <input id="SRCtestimage17" type="hidden" value="${testimage17}" />
      <input id="SRCtestimage18" type="hidden" value="${testimage18}" />
      <input id="SRCtestimage19" type="hidden" value="${testimage19}" />
      <input id="SRCtestimage20" type="hidden" value="${testimage20}" />
      <input id="SRCtestimage21" type="hidden" value="${testimage21}" />
      <input id="SRCtestimage22" type="hidden" value="${testimage22}" />
      <input id="SRCtestimage23" type="hidden" value="${testimage23}" />
      <input id="SRCtestimage24" type="hidden" value="${testimage24}" />
      <input id="SRCtestimage25" type="hidden" value="${testimage25}" />
      <input id="SRCtestimage26" type="hidden" value="${testimage26}" />
      <input id="SRCtestimage27" type="hidden" value="${testimage27}" />
      <input id="SRCtestimage28" type="hidden" value="${testimage28}" />
      <input id="SRCtestimage29" type="hidden" value="${testimage29}" />
      <input id="SRCtestimage30" type="hidden" value="${testimage30}" />
      <input id="SRCtestimage31" type="hidden" value="${testimage31}" />
      <input id="SRCtestimage32" type="hidden" value="${testimage32}" />
      <input id="SRCtestimage33" type="hidden" value="${testimage33}" />
      <input id="SRCtestimage34" type="hidden" value="${testimage34}" />
      <input id="SRCtestimage35" type="hidden" value="${testimage35}" />
      <input id="SRCtestimage36" type="hidden" value="${testimage36}" />
      <input id="SRCtestimage37" type="hidden" value="${testimage37}" />
      <input id="SRCtestimage38" type="hidden" value="${testimage38}" />
      <input id="SRCtestimage39" type="hidden" value="${testimage39}" />
      <input id="SRCtestimage40" type="hidden" value="${testimage40}" />
    </p>

    <p id="hiddenInputTestImageFeedSource" style="display: none">
      <input id="SRCtestimagefeed1" type="hidden" value="${testimagefeed1}" />
      <input id="SRCtestimagefeed2" type="hidden" value="${testimagefeed2}" />
      <input id="SRCtestimagefeed3" type="hidden" value="${testimagefeed3}" />
      <input id="SRCtestimagefeed4" type="hidden" value="${testimagefeed4}" />
      <input id="SRCtestimagefeed5" type="hidden" value="${testimagefeed5}" />
      <input id="SRCtestimagefeed6" type="hidden" value="${testimagefeed6}" />
      <input id="SRCtestimagefeed7" type="hidden" value="${testimagefeed7}" />
      <input id="SRCtestimagefeed8" type="hidden" value="${testimagefeed8}" />
      <input id="SRCtestimagefeed9" type="hidden" value="${testimagefeed9}" />
      <input id="SRCtestimagefeed10" type="hidden" value="${testimagefeed10}" />
      <input id="SRCtestimagefeed11" type="hidden" value="${testimagefeed11}" />
      <input id="SRCtestimagefeed12" type="hidden" value="${testimagefeed12}" />
      <input id="SRCtestimagefeed13" type="hidden" value="${testimagefeed13}" />
      <input id="SRCtestimagefeed14" type="hidden" value="${testimagefeed14}" />
      <input id="SRCtestimagefeed15" type="hidden" value="${testimagefeed15}" />
      <input id="SRCtestimagefeed16" type="hidden" value="${testimagefeed16}" />
      <input id="SRCtestimagefeed17" type="hidden" value="${testimagefeed17}" />
      <input id="SRCtestimagefeed18" type="hidden" value="${testimagefeed18}" />
      <input id="SRCtestimagefeed19" type="hidden" value="${testimagefeed19}" />
      <input id="SRCtestimagefeed20" type="hidden" value="${testimagefeed20}" />
      <input id="SRCtestimagefeed21" type="hidden" value="${testimagefeed21}" />
      <input id="SRCtestimagefeed22" type="hidden" value="${testimagefeed22}" />
      <input id="SRCtestimagefeed23" type="hidden" value="${testimagefeed23}" />
      <input id="SRCtestimagefeed24" type="hidden" value="${testimagefeed24}" />
      <input id="SRCtestimagefeed25" type="hidden" value="${testimagefeed25}" />
      <input id="SRCtestimagefeed26" type="hidden" value="${testimagefeed26}" />
      <input id="SRCtestimagefeed27" type="hidden" value="${testimagefeed27}" />
      <input id="SRCtestimagefeed28" type="hidden" value="${testimagefeed28}" />
      <input id="SRCtestimagefeed29" type="hidden" value="${testimagefeed29}" />
      <input id="SRCtestimagefeed30" type="hidden" value="${testimagefeed30}" />
      <input id="SRCtestimagefeed31" type="hidden" value="${testimagefeed31}" />
      <input id="SRCtestimagefeed32" type="hidden" value="${testimagefeed32}" />
      <input id="SRCtestimagefeed33" type="hidden" value="${testimagefeed33}" />
      <input id="SRCtestimagefeed34" type="hidden" value="${testimagefeed34}" />
      <input id="SRCtestimagefeed35" type="hidden" value="${testimagefeed35}" />
      <input id="SRCtestimagefeed36" type="hidden" value="${testimagefeed36}" />
      <input id="SRCtestimagefeed37" type="hidden" value="${testimagefeed37}" />
      <input id="SRCtestimagefeed38" type="hidden" value="${testimagefeed38}" />
      <input id="SRCtestimagefeed39" type="hidden" value="${testimagefeed39}" />
      <input id="SRCtestimagefeed40" type="hidden" value="${testimagefeed40}" />
    </p>

    <p id="goldenQcenterCoordinates" style="display: none">
      <!-- using golden x1, x2 to store the class for sanity images-->
      <input id="goldenQ_label1" type="hidden" value="${goldenlabel1}" />
      <input id="goldenQ_label2" type="hidden" value="${goldenlabel2}" />
    </p>

    <p id="hiddenTestRealCeters" style="display: none">
      <input id="testCenterX1" type="hidden" value="${testRX1}" />
      <input id="testCenterX2" type="hidden" value="${testRX2}" />
      <input id="testCenterX3" type="hidden" value="${testRX3}" />
      <input id="testCenterX4" type="hidden" value="${testRX4}" />
      <input id="testCenterX5" type="hidden" value="${testRX5}" />
      <input id="testCenterX6" type="hidden" value="${testRX6}" />
      <input id="testCenterX7" type="hidden" value="${testRX7}" />
      <input id="testCenterX8" type="hidden" value="${testRX8}" />
      <input id="testCenterX9" type="hidden" value="${testRX9}" />
      <input id="testCenterX10" type="hidden" value="${testRX10}" />
      <input id="testCenterX11" type="hidden" value="${testRX11}" />
      <input id="testCenterX12" type="hidden" value="${testRX12}" />
      <input id="testCenterX13" type="hidden" value="${testRX13}" />
      <input id="testCenterX14" type="hidden" value="${testRX14}" />
      <input id="testCenterX15" type="hidden" value="${testRX15}" />
      <input id="testCenterX16" type="hidden" value="${testRX16}" />
      <input id="testCenterX17" type="hidden" value="${testRX17}" />
      <input id="testCenterX18" type="hidden" value="${testRX18}" />
      <input id="testCenterX19" type="hidden" value="${testRX19}" />
      <input id="testCenterX20" type="hidden" value="${testRX20}" />
      <input id="testCenterX21" type="hidden" value="${testRX21}" />
      <input id="testCenterX22" type="hidden" value="${testRX22}" />
      <input id="testCenterX23" type="hidden" value="${testRX23}" />
      <input id="testCenterX24" type="hidden" value="${testRX24}" />
      <input id="testCenterX25" type="hidden" value="${testRX25}" />
      <input id="testCenterX26" type="hidden" value="${testRX26}" />
      <input id="testCenterX27" type="hidden" value="${testRX27}" />
      <input id="testCenterX28" type="hidden" value="${testRX28}" />
      <input id="testCenterX29" type="hidden" value="${testRX29}" />
      <input id="testCenterX30" type="hidden" value="${testRX30}" />
      <input id="testCenterX31" type="hidden" value="${testRX31}" />
      <input id="testCenterX32" type="hidden" value="${testRX32}" />
      <input id="testCenterX33" type="hidden" value="${testRX33}" />
      <input id="testCenterX34" type="hidden" value="${testRX34}" />
      <input id="testCenterX35" type="hidden" value="${testRX35}" />
      <input id="testCenterX36" type="hidden" value="${testRX36}" />
      <input id="testCenterX37" type="hidden" value="${testRX37}" />
      <input id="testCenterX38" type="hidden" value="${testRX38}" />
      <input id="testCenterX39" type="hidden" value="${testRX39}" />
      <input id="testCenterX40" type="hidden" value="${testRX40}" />
    </p>

    <p id="canvasFeed1" style="display: none">
      <canvas id="canvas1" width="300" height="250"></canvas>
      <canvas id="canvas2" width="300" height="250"></canvas>
      <canvas id="canvas3" width="300" height="250"></canvas>
      <canvas id="canvas4" width="300" height="250"></canvas>
      <canvas id="canvas5" width="300" height="250"></canvas>
      <canvas id="canvas6" width="300" height="250"></canvas>
      <canvas id="canvas7" width="300" height="250"></canvas>
      <canvas id="canvas8" width="300" height="250"></canvas>
      <canvas id="canvas9" width="300" height="250"></canvas>
      <canvas id="canvas10" width="300" height="250"></canvas>
      <canvas id="canvas11" width="300" height="250"></canvas>
      <canvas id="canvas12" width="300" height="250"></canvas>
      <canvas id="canvas13" width="300" height="250"></canvas>
      <canvas id="canvas14" width="300" height="250"></canvas>
      <canvas id="canvas15" width="300" height="250"></canvas>
      <canvas id="canvas16" width="300" height="250"></canvas>
      <canvas id="canvas17" width="300" height="250"></canvas>
      <canvas id="canvas18" width="300" height="250"></canvas>
      <canvas id="canvas19" width="300" height="250"></canvas>
      <canvas id="canvas20" width="300" height="250"></canvas>
    </p>
    <p id="canvasFeed2" style="display: none">
      <canvas id="canvas21" width="300" height="250"></canvas>
      <canvas id="canvas22" width="300" height="250"></canvas>
      <canvas id="canvas23" width="300" height="250"></canvas>
      <canvas id="canvas24" width="300" height="250"></canvas>
      <canvas id="canvas25" width="300" height="250"></canvas>
      <canvas id="canvas26" width="300" height="250"></canvas>
      <canvas id="canvas27" width="300" height="250"></canvas>
      <canvas id="canvas28" width="300" height="250"></canvas>
      <canvas id="canvas29" width="300" height="250"></canvas>
      <canvas id="canvas30" width="300" height="250"></canvas>
      <canvas id="canvas31" width="300" height="250"></canvas>
      <canvas id="canvas32" width="300" height="250"></canvas>
      <canvas id="canvas33" width="300" height="250"></canvas>
      <canvas id="canvas34" width="300" height="250"></canvas>
      <canvas id="canvas35" width="300" height="250"></canvas>
      <canvas id="canvas36" width="300" height="250"></canvas>
      <canvas id="canvas37" width="300" height="250"></canvas>
      <canvas id="canvas38" width="300" height="250"></canvas>
      <canvas id="canvas39" width="300" height="250"></canvas>
      <canvas id="canvas40" width="300" height="250"></canvas>
    </p>

    <p>
      <input id="numBatchImages" type="hidden" value="${numImages}" />
      <input id="expTime" type="hidden" value="${expTime}" />
      <input id="maxTime" type="hidden" value="${maxTime}" />
      <input id="pswqualtestID" type="hidden" value="${pswqualtest}" />
    </p>

    <p id="hidden-classification-answer">
      <input id="classification-1" name="classification-answer" type="hidden" value="" />
      <input id="classification-2" name="classification-answer" type="hidden" value="" />
      <input id="classification-3" name="classification-answer" type="hidden" value="" />
      <input id="classification-4" name="classification-answer" type="hidden" value="" />
      <input id="classification-5" name="classification-answer" type="hidden" value="" />
      <input id="classification-6" name="classification-answer" type="hidden" value="" />
      <input id="classification-7" name="classification-answer" type="hidden" value="" />
      <input id="classification-8" name="classification-answer" type="hidden" value="" />
      <input id="classification-9" name="classification-answer" type="hidden" value="" />
      <input id="classification-10" name="classification-answer" type="hidden" value="" />
      <input id="classification-11" name="classification-answer" type="hidden" value="" />
      <input id="classification-12" name="classification-answer" type="hidden" value="" />
      <input id="classification-13" name="classification-answer" type="hidden" value="" />
      <input id="classification-14" name="classification-answer" type="hidden" value="" />
      <input id="classification-15" name="classification-answer" type="hidden" value="" />
      <input id="classification-16" name="classification-answer" type="hidden" value="" />
      <input id="classification-17" name="classification-answer" type="hidden" value="" />
      <input id="classification-18" name="classification-answer" type="hidden" value="" />
      <input id="classification-19" name="classification-answer" type="hidden" value="" />
      <input id="classification-20" name="classification-answer" type="hidden" value="" />
      <input id="classification-21" name="classification-answer" type="hidden" value="" />
      <input id="classification-22" name="classification-answer" type="hidden" value="" />
    </p>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script language="javascript">
      /////////////////////////////////////////////////////////////////////
      //                     global params                               //
      /////////////////////////////////////////////////////////////////////
      var firstTimeExample = true;
      const imageSwitchTime = 2000; // 3 seconds
      var currImage = 1;
      var currTestImage = 1;
      var batchSize = 20;
      var batchTestSize = 20;

      var Ux = 'useranswerX1';
      var Uy = 'useranswerY1';
      var Ucat = 'useranswerCat1';
      var RT = 'rt1';
      var IM = 'img1';

      var TIM = 'testimg1';
      var TUx = 'testuseranswerX1';
      var TUy = 'testuseranswerY1';

      var TRCx = 'testCenterX1';
      var TRCy = 'testCenterY1';

      var fullurl = window.location.href;
      var assign = turkGetParam('assignmentId');
      var hit = turkGetParam('hitId');
      var worker = turkGetParam('workerId');

      window.onload = function () {
        document.getElementById('submitButton').setAttribute('onclick', false);
      };

      var startTime;
      var endTime;

      var startTestTime;
      var endTestTime;
      var TotalTestTime;

      var startWorkTime;
      var endWorkTime;
      var TotalWorkTime;

      var TotalTestAccuracy = 0;

      var isTestQpassed = false;

      var CurrentPhase; // qTest or Work

      var isAccuracyGood = 1;

      var myImg;

      var currpsw;

      var GoldenDist1;
      var GoldenDist2;
      var GoldenDistAll;

      /////////////////////////////////////////////////////////////////////
      //                     Initialization                              //
      /////////////////////////////////////////////////////////////////////

      function turkGetParam(name) {
        var regexS = '[\?&]' + name + '=([^&#]*)';
        var regex = new RegExp(regexS);
        var tmpURL = fullurl;
        var results = regex.exec(tmpURL);
        if (results == null) {
          return '';
        } else {
          return results[1];
        }
      }

      window.onload = function () {
        document.getElementById('skipButton').disabled = true;
        batchSize = parseInt(document.getElementById('numBatchImages').value);
        document.getElementById('proceedButton').disabled = false;
        document.getElementById('proceedButton').value = 'Start';
        document.getElementById('proceedButton').style.width = '300px';
        document.getElementById('submitButton').style.visibility = 'hidden';
      };

      /////////////////////////////////////////////////////////////////////
      //                     Qualification Test                          //
      /////////////////////////////////////////////////////////////////////
      function checkPassQual() {
          if (document.getElementById('pswQualification').value == document.getElementById('pswqualtestID').value) {
              document.getElementById('skipButton').disabled = false;
          } else {
              document.getElementById('skipButton').disabled = true;
          }
      }
          
      function startTest() {
          startTestTime = Date.now();
          CurrentPhase = "qTest";
          
          currpsw = document.getElementById('pswqualtestID').value;
          
          myImg = document.getElementById(TIM);
          addNoise_test(TIM);
          document.getElementById(TIM).style.display = 'block';
          addNoise_test(TIM);
          myImg.onmousedown = GetCoordinates;
      }
          
      function addNoise_test(IM) {
        var id = '#' + IM;

        var interval;
        function isEven(n) {
          return isNumber(n) && n % 2 == 0;
        }
        function isNumber(n) {
          return n === parseFloat(n);
        }

        setTimeout(function () {
          var src = $(id).attr('src');
          var alt = 'https://human-responsiveness.s3.ca-central-1.amazonaws.com/noise.jpg';
          $(id).attr('src', alt);
          var count = 0;
          interval = setInterval(function () {
            count++;
            if (count == 2) {
              clearInterval(interval);
              return false;
            }

            isEven(count) ? $(id).attr('src', alt) : $(id).attr('src', src);
          }, 20);
        }, 200);
      }

      function nextTestImage() {
        console.log('in nextTestImage')
          showFeedbackContent(currTestImage);
          if (currTestImage == batchTestSize || currTestImage == 2*batchTestSize){
              if (!isTestQpassed) {
                  if (currTestImage == batchTestSize) {
                      //1st time fail
                      document.getElementById('resultsFail1').style.display = 'block';
                      document.getElementById('resultsFail2').style.display = 'none';
                  } else {
                      //2nd time fail
                      document.getElementById('resultsFail2').style.display = 'block';
                      document.getElementById('resultsFail1').style.display = 'none';
                  }
              } else {
                  //show results success
                  document.getElementById('resultsFail1').style.display = 'none';
                  document.getElementById('resultsFail2').style.display = 'none';
                  document.getElementById('resultsSuccess').style.display = 'block';
                  
                  var passText = document.getElementById('writePassword');
                  passText.innerHTML = "<h4><tt>" + currpsw + "</h4></tt>";
                  
              }
              
              currTestImage = currTestImage + 1;
              var strImg = currTestImage.toString();
              if (currTestImage > 10) {
                  var tmpSub = 2;
              } else {
                  var tmpSub = 1;
              }
              
              TUx = TUx.substring(0, TUx.length - tmpSub);
              TUx = TUx.concat(strImg); 
              TUy = TUy.substring(0, TUy.length - tmpSub);
              TUy = TUy.concat(strImg); 
              
              if (currTestImage == batchTestSize+1) {
                  tmpS ='SRCtestimage';
                  tmpS = tmpS.concat(strImg);
                  document.getElementById(TIM).src= document.getElementById(tmpS).value;
                  
                  addNoise_test(TIM);
                  myImg = document.getElementById(TIM);
                  addNoise_test(TIM);
                  myImg.onmousedown = GetCoordinates;
              }
              
              //feedback and results
              document.getElementById('QTest').style.display = 'none';
              document.getElementById('QFeedback').style.display = 'block';
              document.getElementById('QResults').style.display = 'block';
              
              
              for (qq=1;qq<=40;qq++) {
                  var strImg = qq.toString();
                  var tmpStr = "feedIm";
                  tmpStr = tmpStr.concat(strImg);
                  var currimg = document.getElementById(tmpStr);
                  var tmpStr = "canvas";
                  tmpStr = tmpStr.concat(strImg);
                  var cnvs = document.getElementById(tmpStr);
                  
                  cnvs.style.position = "absolute";
                  cnvs.style.left = offsetDim(currimg).left + "px";
                  cnvs.style.top = offsetDim(currimg).top + "px";
                  
                  if (qq==20 || qq==40){
                      cnvs.style.left = (offsetDim(currimg).left - 150) + "px";
                  }
              }
        
          }
          else {
              currTestImage = currTestImage + 1;
              var strImg = currTestImage.toString();
              
              if (currTestImage > 10) {
                  var tmpSub = 2;
              } else {
                  var tmpSub = 1;
              }

              TUx = TUx.substring(0, TUx.length - tmpSub);
              TUx = TUx.concat(strImg); 
              TUy = TUy.substring(0, TUy.length - tmpSub);
              TUy = TUy.concat(strImg); 
              
              tmpS ='SRCtestimage';
              tmpS = tmpS.concat(strImg);
              document.getElementById(TIM).src= document.getElementById(tmpS).value;
              addNoise_test(TIM);
              myImg = document.getElementById(TIM);
              addNoise_test(TIM);
              myImg.onmousedown = GetCoordinates;
          }
      }
          
      function offsetDim(elem) {
        if(!elem) elem = this;

        var x = elem.offsetLeft;
        var y = elem.offsetTop;

        while (elem = elem.offsetParent) {
          x += elem.offsetLeft;
          y += elem.offsetTop;
        }

        return { left: x, top: y };
      }
          
      function showFeedbackContent(testImgNum) {
          var contText = document.getElementById('feedbackContent');

          if(testImgNum == 1 || testImgNum == batchTestSize + 1) {
              contText.innerHTML = "";
              isTestQpassed = false;
          }

          var strImg = testImgNum.toString();
          var srcFeed = 'SRCtestimagefeed';
          srcFeed = srcFeed.concat(strImg);
          imgSrcFeedback = document.getElementById(srcFeed).value;
          
          user_answer = document.getElementById('testuseranswerX'.concat(testImgNum.toString())).value;
          ground_truth = document.getElementById('testCenterX'.concat(testImgNum.toString())).value;

          if (user_answer == ground_truth){
            contText.innerHTML = contText.innerHTML + "<table id='tableFeed" + strImg + " border='1' cellpadding='10' style='vertical-align: middle;width: 33.3%; float: left;border-collapse: collapse;'><tbody><tr><td style='vertical-align: middle;' align='middle'><br />Image of "+ ground_truth+" <img id='feedIm" + strImg +"' align='middle' src=" + imgSrcFeedback  + " style='height:250px;max-width:300px;width: expression(this.width > 300 ? 300: true);' /><br />You answered:" + "<b style='color:green;'>" + user_answer + "</b></td></tr></tbody></table>";
          } else{
            contText.innerHTML = contText.innerHTML + "<table id='tableFeed" + strImg + " border='1' cellpadding='10' style='vertical-align: middle;width: 33.3%; float: left;border-collapse: collapse;'><tbody><tr><td style='vertical-align: middle;' align='middle'><br />Image of "+ ground_truth+" <img id='feedIm" + strImg +"' align='middle' src=" + imgSrcFeedback  + " style='height:250px;max-width:300px;width: expression(this.width > 300 ? 300: true);' /><br />You answered:" + "<b style='color:red;'>" + user_answer + "</b></td></tr></tbody></table>";
          }
          
          
          if(testImgNum == batchTestSize || testImgNum == 2*batchTestSize) {
              // check for missing answers
              test_result_str = 'testuseranswerX'
              test_gt = 'testCenterX'
              num_correct = 0
              for (let i = 1; i <= batchTestSize; i++) {
                user_answer = document.getElementById(test_result_str.concat(i.toString())).value;

                if (user_answer.length ==0){
                  isTestQpassed = false;
                }
                console.log(test_gt.concat(i.toString()))

                console.log(document.getElementById(test_gt.concat(i.toString())))
                ground_truth = document.getElementById(test_gt.concat(i.toString())).value;
                if (user_answer == ground_truth){
                  num_correct = num_correct + 1;
                }

                console.log("test image " + i.toString() + ', user_answer: ' + user_answer + ', ground_truth: '+ ground_truth)

              }
              console.log("num_correct: " + num_correct.toString())
          
              if (testImgNum == batchTestSize) {
                  document.getElementById("canvasFeed1").style.display = 'block';
              } else {
                  document.getElementById("canvasFeed2").style.display = 'block';
              }
              
              endTestTime = Date.now();
              TotalTestTime = (endTestTime - startTestTime)/1000;
              var SpeedComment = "<h3> You completed the qualification test in <strong>" + TotalTestTime.toString() + "</strong> seconds.</h3>";
              
              var AccuracyComment = "<h3> Your average classiification accuracy was <strong>" + num_correct.toString() + "/" + batchTestSize.toString() + "</strong>.</h3>";
              
              var extraComment = '<p>The correct classes of the images are shown above them and your answers are shown below. <b style="color:green;text-shadow: 0px 0px 2px #000000">green</b> are correct answers, while the  <b style="color:red;text-shadow: 0px 0px 2px #000000">red</b> are incorrect answers.</p>';
              
              contText.innerHTML = SpeedComment + AccuracyComment + extraComment + contText.innerHTML;
              
              if (num_correct == batchTestSize) {
                  isTestQpassed = true;
                  document.getElementById('TestRT').value = TotalTestTime;
                  document.getElementById('TestAccuracy').value = TotalTestAccuracy;
              }
          }
      }
          
      function drawOnFeedImage(testImgNum,user_answer,ground_truth) {
          var strImg = testImgNum.toString();
          var tmpStr = "feedIm";
          tmpStr = tmpStr.concat(strImg);
          var currimg = document.getElementById(tmpStr);
          var tmpStr = "canvas";
          tmpStr = tmpStr.concat(strImg);
          var cnvs = document.getElementById(tmpStr);
          
          cnvs.style.position = "absolute";
          cnvs.style.left = currimg.offsetLeft + "px";
          cnvs.style.top = currimg.offsetTop + "px";
          
          var context = cnvs.getContext("2d");

          var imgDisplayTest = document.getElementById("testimg1");

          var img = new Image();
          img.src = imgDisplayTest;

          img.onload = function () {
              context.drawImage(img, 0, 0);
              context.lineWidth = 1;
              context.fillStyle = "#CC00FF";
              context.lineStyle = "#ffff00";
              context.font = "18px sans-serif";
              context.fillText(user_answer, 50, 50);
          };
      }
      /////////////////////////////////////////////////////////////////////
      //                     Work Session                                //
      /////////////////////////////////////////////////////////////////////
      function startWork() {
        startTime = Date.now();
        CurrentPhase = 'Work';
        startWorkTime = Date.now();
        document.getElementById('workCountImages').innerHTML = currImage + '/' + batchSize;

        myImg = document.getElementById(IM);
        addNoise_work(IM, myImg);
        document.getElementById(IM).style.display = 'block';
        addNoise_work(IM, myImg);
        myImg.onmousedown = GetCoordinates;
      }

      function FindPosition(oElement) {
        if (typeof oElement.offsetParent != 'undefined') {
          for (var posX = 0, posY = 0; oElement; oElement = oElement.offsetParent) {
            posX += oElement.offsetLeft;
            posY += oElement.offsetTop;
          }
          return [posX, posY];
        } else {
          return [oElement.x, oElement.y];
        }
      }

      function GetCoordinates(e) {
        var PosX = 0;
        var PosY = 0;
        var ImgPos;
        ImgPos = FindPosition(myImg);
        if (!e) var e = window.event;
        if (e.pageX || e.pageY) {
          PosX = e.pageX;
          PosY = e.pageY;
        } else if (e.clientX || e.clientY) {
          PosX = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
          PosY = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
        }
        PosX = PosX - ImgPos[0];
        PosY = PosY - ImgPos[1];

        if (CurrentPhase == 'qTest') {
          document.getElementById(TUx).value = PosX;
          document.getElementById(TUy).value = PosY;
          nextTestImage();
        } else if (CurrentPhase == 'Work') {
          endTime = Date.now();
          document.getElementById(RT).value = endTime - startTime;
          document.getElementById(Ux).value = PosX;
          document.getElementById(Uy).value = PosY;
        }
      }

      function addNoise_work(IM, currImage) {
        var id = '#' + IM;

        var interval;
        function isEven(n) {
          return isNumber(n) && n % 2 == 0;
        }
        function isNumber(n) {
          return n === parseFloat(n);
        }

        setTimeout(function () {
          var src = $(id).attr('src');
          var alt = 'https://human-responsiveness.s3.ca-central-1.amazonaws.com/noise.jpg';
          $(id).attr('src', alt);
          var count = 0;
          interval = setInterval(function () {
            count++;
            if (count == 2) {
              clearInterval(interval);
              return false;
            }

            isEven(count) ? $(id).attr('src', alt) : $(id).attr('src', src);
          }, 20);
        }, 200);
      }

      function nextImage() {
        if (currImage == batchSize) {
          endWorkTime = Date.now();
          TotalWorkTime = (endWorkTime - startWorkTime) / 1000;

          document.getElementById('finishText').innerHTML =
            '<p> You have successfully completed this HIT in <strong>' +
            TotalWorkTime.toString() +
            '</strong> seconds. <br /> Press the buttton below to SUBMIT this HIT.</p>';

          document.getElementById('Work').style.display = 'none';

          // check if all the answers have been filled
          classification_str = 'classification-'
          for (let i = 1; i <= batchSize; i++) {
            user_answer = document.getElementById(classification_str.concat(i.toString())).value;
            if (user_answer.length ==0){
              isAccuracyGood = 0;
            }
          }

          if (isAccuracyGood >= 1) {
            document.getElementById('Finish').style.display = 'block';
            document.getElementById('submitButton').style.visibility = 'visible';
          } else {
              document.getElementById('LowAccuracy').style.display = 'block';
          } 
        
        } else {
          if (currImage == 8) {
            UserGoldenX = document.getElementById('classification-8').value;
            RealGoldenClass = document.getElementById('goldenQ_label1').value;
            if (UserGoldenX != RealGoldenClass){
              isAccuracyGood = 0;
            }
          } else if (currImage == 16) {
            UserGoldenX = document.getElementById('classification-16').value;
            RealGoldenClass = document.getElementById('goldenQ_label2').value;

            if (UserGoldenX != RealGoldenClass){
              isAccuracyGood = 0;
            }
          } 

          currImage = currImage + 1;
          var strImg = currImage.toString();

          if (currImage > 10) {
            var tmpSub = 2;
          } else {
            var tmpSub = 1;
          }

          Ux = Ux.substring(0, Ux.length - tmpSub);
          Ux = Ux.concat(strImg);

          Uy = Uy.substring(0, Uy.length - tmpSub);
          Uy = Uy.concat(strImg);

          Ucat = Ucat.substring(0, Ucat.length - tmpSub);
          Ucat = Ucat.concat(strImg);

          RT = RT.substring(0, RT.length - tmpSub);
          RT = RT.concat(strImg);

          document.getElementById(IM).style.display = 'none';
          IM = IM.substring(0, IM.length - tmpSub);
          IM = IM.concat(strImg);
          addNoise_work(IM, currImage);
          document.getElementById(IM).style.display = 'block';
          addNoise_work(IM, currImage);

          startTime = Date.now();
          document.getElementById('workCountImages').innerHTML = currImage + '/' + batchSize;

          myImg = document.getElementById(IM);
          myImg.onmousedown = GetCoordinates;
        }
      }
      function Nothing() {
        console.log('nothing');
      }

      function SubmitData() {
        // save category from form
        var radioValue = $("input[name='category']:checked").val();
        if (radioValue) {
          document.getElementById(Ucat).value = radioValue;
        }
        // restet form
        $('input[name=category]').attr('checked', false);

        nextImage();
      }

      function addNoise_example() {
      
        if (firstTimeExample == true) {
          document.getElementById('proceedButton').disabled = false;
          document.getElementById('proceedButton').value = 'PROCEED to the qualification test';
          document.getElementById('proceedButton').style.width = '300px';
          document.getElementById('submitButton').style.visibility = 'hidden';
          var interval;
          function isEven(n) {
            return isNumber(n) && n % 2 == 0;
          }
          function isNumber(n) {
            return n === parseFloat(n);
          }
          $(document).ready(function () {
            setTimeout(function () {
              var src = $('#imgExample').attr('src');
              var alt = 'https://human-responsiveness.s3.ca-central-1.amazonaws.com/IMG_0014.jpg';
              $('#imgExample').attr('src', alt);
              var count = 0;
              interval = setInterval(function () {
                count++;
                if (count == 2) {
                  clearInterval(interval);
                  return false;
                }

                isEven(count)
                  ? $('#imgExample').attr('src', alt)
                  : $('#imgExample').attr('src', src);
              }, 200);
            }, 2000);
          });
        }
      }

      // select class event
      $('#select-btn-group > button').click((e) => {
        const new_id = '#classification-' + currImage.toString();
        $(new_id).val(e.target.value);
        // start countdown then switch image.
        let time = 0;
        $('#countdown-header').removeClass('hidden');
        $('#countdown-header').text('Countdown: ' + (imageSwitchTime / 1000).toString());
        const interval = setInterval(function () {
          time += 1;
          const timeLeft = (imageSwitchTime - time * 1000) / 1000;
          if (timeLeft === 0) {
            clearInterval(interval);
          }
          $('#countdown-header').text('Countdown: ' + timeLeft.toString());
        }, 1000);
        setTimeout(() => {
          $('#countdown-header').addClass('hidden');
          nextImage();
        }, imageSwitchTime);
      });

      $('#select-btn-group-test > button').click((e) => {
        const new_id = '#testuseranswerX' + currTestImage.toString();
        $(new_id).val(e.target.value);
        console.log(new_id)
        console.log(document.getElementById('testuseranswerX'.concat(currTestImage.toString())))
        // start countdown then switch image.
        let time = 0;
        $('#countdown-header-test').removeClass('hidden');
        $('#countdown-header-test').text('Countdown: ' + (imageSwitchTime / 1000).toString());
        const interval = setInterval(function () {
          time += 1;
          const timeLeft = (imageSwitchTime - time * 1000) / 1000;
          if (timeLeft === 0) {
            clearInterval(interval);
          }
          $('#countdown-header-test').text('Countdown: ' + timeLeft.toString());
        }, 1000);
        setTimeout(() => {
          $('#countdown-header-test').addClass('hidden');
          nextTestImage();
        }, imageSwitchTime);
      });
    </script>
  </body>
</html>
